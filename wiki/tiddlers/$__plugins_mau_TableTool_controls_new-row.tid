created: 20170412093519250
creator: )+(auloop
modified: 20180903161609380
modifier: )+(auloop
tags: $:/tags/ttControl TableToolPlugin
title: $:/plugins/mau/TableTool/controls/new-row
type: text/vnd.tiddlywiki

\define check-key-list() 
<$list filter="""[list<tbl-conf>]""" variable="tt-col-id">
<!-- $list filter="""[<tt-col-id>addprefix[/]addprefix<tbl-conf>tt-key[yes]]""" variable="tt-col" -->
<$list filter="""[<tt-col>tt-key[yes]]""" variable="tt-col">
<$set name="k" tiddler="$:/temp/tt/new-row" index=<<tt-col-id>> >
<$set name="chk" filter="""[enlist<k>]""" value="" emptyValue="x"><<chk>></$set>
</$set>
</$list>
</$list>
\end

\define check-key()
<$wikify name="chk" text=<<check-key-list>> >
<$set name="go" filter="""[enlist<chk>]""" value="do-not-set-new-row" emptyValue="ok-to-set-new-row">
<$macrocall $name=<<go>> />
</$set>
</$wikify>
\end

\define ok-to-set-new-row()
<$button message="tm-close-tiddler" actions=<<tt-set-new-row>> >{{$:/core/images/done-button}}</$button>
\end

\define tt-set-new-row()
<$set name="id" value=<<now "YYYY0MM0DD0hh0mm0ss">> >
<$wikify name="tt-row-id" text=<<tt-row-id>> >

<$action-setfield $tiddler="$:/temp/tt/new-row" title=<<tt-row-id>> />
<$action-listops $tiddler=<<tt-row-id>> $tags="""[<tbl-name>]""" />

<$list filter="""[list<tbl-conf>]""" variable="tt-col-id">
<$action-setfield $tiddler=<<tt-row-id>> $field=<<tt-col-id>> $value="tdView" />
</$list>

</$wikify>
</$set>
\end

<!---------------------
-- "New record" control
-->
<$button>
New row
<!-- $action-sendmessage $message="tm-modal" $param="$:/plugins/mau/TableTool/controls/row-dialog" currentTiddler="$:/temp/tt/new-row" tbl-name=<<tbl-name>> tbl-layout=<<tbl-layout>> tbl-conf=<<tbl-conf>> tt-col-id=<<tt-col-id>> tt-col=<<tt-col>> check-key=<<check-key>> check-key-list=<<check-key-list>> ok-to-set-new-row=<<ok-to-set-new-row>> tt-set-new-row=<<tt-set-new-row>> / -->
<$action-sendmessage $message="tm-modal" $param="$:/plugins/mau/TableTool/controls/row-dialog" currentTiddler="$:/temp/tt/new-row" tbl-name=<<tbl-name>> tbl-layout=<<tbl-layout>> check-key=<<check-key>> check-key-list=<<check-key-list>> ok-to-set-new-row=<<ok-to-set-new-row>> tt-set-new-row=<<tt-set-new-row>> />
<$action-setfield $tiddler="$:/temp/tt/new-row" type="application/json" text="" />
</$button>